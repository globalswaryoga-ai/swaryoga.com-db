# Architecture Diagram & Data Flow

## ğŸ—ï¸ System Architecture

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                         SWAR YOGA SYSTEM                            â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”       â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”       â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  Web Frontend       â”‚       â”‚   Admin Panel    â”‚       â”‚   Mobile   â”‚
â”‚  - Workshops page   â”‚       â”‚  - CRM (leads)   â”‚       â”‚    App     â”‚
â”‚  - Media page       â”‚       â”‚  - Media manager â”‚       â”‚   Auth     â”‚
â”‚  - Purchase flow    â”‚       â”‚  - Reports       â”‚       â”‚            â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜       â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜       â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
           â”‚                          â”‚                        â”‚
           â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                        â”‚
                          â”‚                                    â”‚
        â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                â”‚
        â”‚    Next.js App Router API          â”‚                â”‚
        â”‚  /api/admin/workshops/recorded    â”‚                â”‚
        â”‚  /api/admin/media                  â”‚                â”‚
        â”‚  /api/workshops/recorded/purchase  â”‚                â”‚
        â”‚  /api/webhooks/zoom/recording      â”‚                â”‚
        â””â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”˜                â”‚
             â”‚                           â”‚                    â”‚
     â”Œâ”€â”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”         â”Œâ”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”       â”‚
     â”‚   MongoDB       â”‚         â”‚  Rate Limiting &  â”‚       â”‚
     â”‚   Database      â”‚         â”‚  Authentication   â”‚       â”‚
     â”‚                 â”‚         â”‚  (JWT)            â”‚       â”‚
     â”‚ â€¢ RecordedWS    â”‚         â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜       â”‚
     â”‚ â€¢ UserProgress  â”‚                                      â”‚
     â”‚ â€¢ MediaPost     â”‚                                      â”‚
     â”‚ â€¢ Order         â”‚                                      â”‚
     â”‚ â€¢ User          â”‚                                      â”‚
     â”‚ â€¢ Lead          â”‚                                      â”‚
     â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                                      â”‚
                                                              â”‚
     â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”         â”‚
     â”‚           EXTERNAL SERVICES                 â”‚         â”‚
     â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜         â”‚
             â”‚                           â”‚                    â”‚
       â”Œâ”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”             â”Œâ”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”         â”‚
       â”‚  AWS S3   â”‚             â”‚  Zoom API       â”‚         â”‚
       â”‚           â”‚             â”‚                  â”‚         â”‚
       â”‚ Buckets:  â”‚             â”‚ â€¢ OAuth2 Token  â”‚         â”‚
       â”‚ â€¢ Public  â”‚             â”‚ â€¢ Create Meetingâ”‚         â”‚
       â”‚ â€¢ Private â”‚             â”‚ â€¢ Get Recording â”‚         â”‚
       â”‚           â”‚             â”‚ â€¢ Download File â”‚         â”‚
       â”‚ Storage:  â”‚             â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜         â”‚
       â”‚ â€¢ Videos  â”‚                    â”‚                    â”‚
       â”‚ â€¢ Images  â”‚                    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”         â”‚
       â”‚ â€¢ PDFs    â”‚                               â”‚         â”‚
       â”‚ â€¢ Certs   â”‚                    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”   â”‚
       â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                    â”‚ Live Workshop â”‚   â”‚
                                        â”‚                â”‚   â”‚
                                        â”‚ Auto-recording â”‚   â”‚
                                        â”‚ Auto-download  â”‚   â”‚
                                        â”‚ Auto-upload S3 â”‚   â”‚
                                        â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚
                                                             â”‚
             â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
             â”‚
       â”Œâ”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
       â”‚   Social Media     â”‚
       â”‚   Integration      â”‚
       â”‚                    â”‚
       â”‚ â€¢ WhatsApp API     â”‚
       â”‚ â€¢ Facebook Graph   â”‚
       â”‚ â€¢ Instagram API    â”‚
       â”‚ â€¢ Twitter API      â”‚
       â”‚ â€¢ Community Groups â”‚
       â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

## ğŸ“Š Data Flow Diagrams

### 1. Live Workshop Recording Flow

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚   Admin     â”‚
â”‚   Creates   â”‚
â”‚ Workshop    â”‚
â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”˜
       â”‚
       â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ POST /api/admin/     â”‚
â”‚ zoom/create-meeting  â”‚
â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
       â”‚
       â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”         â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  Zoom API Creates    â”‚â”€â”€â”€â”€â”€â”€â”€â”€â–¶â”‚  MongoDB Saves   â”‚
â”‚  Meeting with        â”‚         â”‚  Meeting Details â”‚
â”‚  auto_recording:true â”‚         â”‚  in RecordedWS   â”‚
â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜         â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
       â”‚
       â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ Share Zoom Link with â”‚
â”‚ Students (email etc) â”‚
â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
       â”‚
       â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  Live Workshop       â”‚
â”‚  Happens             â”‚
â”‚  Zoom Records Auto   â”‚
â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
       â”‚
       â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ Workshop Ends        â”‚
â”‚ Webhook Triggered:   â”‚
â”‚ recording.completed  â”‚
â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
       â”‚
       â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ /api/webhooks/zoom/      â”‚
â”‚ recording endpoint       â”‚
â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
       â”‚
       â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”      â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ Download Recording       â”‚â”€â”€â”€â”€â”€â–¶â”‚ AWS S3 Upload    â”‚
â”‚ from Zoom               â”‚      â”‚ to Private Bucketâ”‚
â”‚ (with OAuth token)      â”‚      â””â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜            â”‚
                                        â–¼
                                â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
                                â”‚ RecordedWS Updated with  â”‚
                                â”‚ S3 Video URL             â”‚
                                â”‚ (languages.*.videoUrl)   â”‚
                                â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                                       â”‚
                                       â–¼
                                â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
                                â”‚ Video Available for      â”‚
                                â”‚ Purchase/Viewing         â”‚
                                â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### 2. Recorded Workshop Purchase Flow

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚   User     â”‚
â”‚  Browses   â”‚
â”‚ Workshops  â”‚
â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”˜
       â”‚
       â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ /app/recorded-workshops      â”‚
â”‚ page.tsx                     â”‚
â”‚                              â”‚
â”‚ Shows 18 workshops Ã— 3 langs â”‚
â”‚ (Hindi, English, Marathi)    â”‚
â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
       â”‚
       â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ User Selects Language &      â”‚
â”‚ Clicks Purchase Button       â”‚
â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
       â”‚
       â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”      â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ POST /api/workshops/         â”‚â”€â”€â”€â”€â”€â–¶â”‚ MongoDB Order:      â”‚
â”‚ recorded/[id]/purchase       â”‚      â”‚ - userId            â”‚
â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜      â”‚ - workshopId        â”‚
       â”‚                              â”‚ - language          â”‚
       â–¼                              â”‚ - price             â”‚
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”      â”‚ - paymentStatus     â”‚
â”‚ PayU Payment Gateway         â”‚      â””â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
â”‚ (existing integration)       â”‚            â”‚
â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜            â–¼
       â”‚                          â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
       â–¼                          â”‚ Create UserWorkshop â”‚
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚ Progress record     â”‚
â”‚ Payment Successful Callback  â”‚â”€â”‚ - Register device   â”‚
â”‚ /api/payments/payu/callback  â”‚ â”‚ - Set device limit  â”‚
â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚ - Start tracking    â”‚
       â”‚                          â””â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
       â–¼                                 â”‚
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”         â–¼
â”‚ Generate Pre-signed S3 URL   â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ Valid for 1 hour             â”‚  â”‚ Add to User's       â”‚
â”‚ (lib/aws-s3.ts)              â”‚  â”‚ Purchased List      â”‚
â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
       â”‚
       â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ Video Available in:          â”‚
â”‚ - User Profile               â”‚
â”‚ - My Sessions Page           â”‚
â”‚ - Mobile App                 â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### 3. Device Limit Enforcement Flow

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚   User     â”‚
â”‚   Starts   â”‚
â”‚ Watching   â”‚
â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”˜
       â”‚
       â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ Generate Device Fingerprint  â”‚
â”‚ - Browser UA                 â”‚
â”‚ - IP Address                 â”‚
â”‚ - Device Type                â”‚
â”‚ - Screen Resolution          â”‚
â”‚ - Stored in localStorage     â”‚
â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
       â”‚
       â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ Query UserWorkshopProgress:  â”‚
â”‚ registeredDevices[]          â”‚
â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
       â”‚
       â–¼
       â”œâ”€ Device Count < 3?
       â”‚  â””â”€ YES â”€â”€â–¶ Register New Device
       â”‚            â””â”€ Add to registeredDevices[]
       â”‚            â””â”€ Set firstAccessAt = now
       â”‚
       â””â”€ Device Count >= 3?
          â””â”€ YES â”€â”€â–¶ Check if Same Device?
                    â”‚
                    â”œâ”€ YES (fingerprint matches)
                    â”‚   â””â”€ Allow (update lastAccessAt)
                    â”‚
                    â””â”€ NO (new device)
                        â””â”€ Check 24-hour Gap
                        â”‚  (lastAccessAt < 24h ago?)
                        â”‚
                        â”œâ”€ Gap OK (>24h)
                        â”‚   â””â”€ Replace oldest device
                        â”‚   â””â”€ Allow access
                        â”‚
                        â””â”€ Gap NOT OK (<24h)
                            â””â”€ DENY ACCESS
                            â””â”€ Show error message
                                with countdown
```

### 4. Media Post Publishing Flow

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  Admin   â”‚
â”‚ Creates  â”‚
â”‚ Post     â”‚
â””â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”˜
     â”‚
     â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ /admin/media-management    â”‚
â”‚                            â”‚
â”‚ Form:                      â”‚
â”‚ - Title                    â”‚
â”‚ - Blocks (alternating)     â”‚
â”‚ - Images/Videos (S3 URLs)  â”‚
â”‚ - Sidebars                 â”‚
â”‚ - Social media toggles     â”‚
â””â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
     â”‚
     â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ POST /api/admin/media      â”‚
â”‚                            â”‚
â”‚ Creates MediaPost document â”‚
â””â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
     â”‚
     â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ Status: draft              â”‚
â”‚ Can Preview                â”‚
â”‚ Can Schedule               â”‚
â”‚ Can Publish                â”‚
â””â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
     â”‚
     â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ Admin Reviews              â”‚
â”‚ Toggles Social Media:      â”‚
â”‚ â˜ WhatsApp Groups          â”‚
â”‚ â˜ Facebook Page            â”‚
â”‚ â˜ Instagram                â”‚
â”‚ â˜ Twitter                  â”‚
â”‚ â˜ Community Groups         â”‚
â””â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
     â”‚
     â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ PUT /api/admin/media/[id]/publish  â”‚
â”‚                                    â”‚
â”‚ Set status: published              â”‚
â”‚ Set publishedAt: now               â”‚
â””â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
     â”‚
     â”œâ”€ WhatsApp? â”€â”€â–¶ Send to Group IDs
     â”‚               (via WhatsApp API)
     â”‚
     â”œâ”€ Facebook? â”€â”€â–¶ Post to Page
     â”‚                (via FB Graph API)
     â”‚
     â”œâ”€ Instagram? â”€â–¶ Post Image/Video
     â”‚                (via IG API)
     â”‚
     â”œâ”€ Twitter? â”€â”€â”€â–¶ Tweet with Image
     â”‚                (via Twitter API)
     â”‚
     â””â”€ Community Groups? â”€â”€â–¶ DB Leads broadcast
                             (internal groups)
     
     â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ /app/media page            â”‚
â”‚                            â”‚
â”‚ Displays all posts in      â”‚
â”‚ alternating block layout   â”‚
â”‚ with sidebars              â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

## ğŸ”„ Workflow: 18 Workshops Ã— 3 Languages

```
Step 1: Admin Uploads Recorded Workshops
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                                                             â”‚
â”‚  For Each Workshop (18 total):                             â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
â”‚  â”‚ 1. Record on Zoom with auto_recording enabled      â”‚  â”‚
â”‚  â”‚ 2. Recording auto-downloads to AWS S3              â”‚  â”‚
â”‚  â”‚ 3. Create separate video files for each language:  â”‚  â”‚
â”‚  â”‚    - breathwork/hindi/video.mp4                    â”‚  â”‚
â”‚  â”‚    - breathwork/english/video.mp4                  â”‚  â”‚
â”‚  â”‚    - breathwork/marathi/video.mp4                  â”‚  â”‚
â”‚  â”‚ 4. Upload instructor image                         â”‚  â”‚
â”‚  â”‚ 5. Upload 3 thumbnail images (one per language)    â”‚  â”‚
â”‚  â”‚ 6. Create RecordedWorkshop document:               â”‚  â”‚
â”‚  â”‚    {                                                â”‚  â”‚
â”‚  â”‚      workshopSlug: "breathwork",                   â”‚  â”‚
â”‚  â”‚      languages: {                                   â”‚  â”‚
â”‚  â”‚        hindi: { videoUrl: "s3://...", ... },       â”‚  â”‚
â”‚  â”‚        english: { videoUrl: "s3://...", ... },     â”‚  â”‚
â”‚  â”‚        marathi: { videoUrl: "s3://...", ... }      â”‚  â”‚
â”‚  â”‚      },                                             â”‚  â”‚
â”‚  â”‚      pricing: { hindi: 499, english: 599, ... }    â”‚  â”‚
â”‚  â”‚    }                                                â”‚  â”‚
â”‚  â”‚ 7. Set status: "published"                         â”‚  â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
â”‚                                                             â”‚
â”‚  Repeat for all 18 workshops                              â”‚
â”‚                                                             â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

Step 2: Website Displays All 54 Workshop Variants (18 Ã— 3)
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ /app/recorded-workshops/page.tsx                            â”‚
â”‚                                                             â”‚
â”‚ Grid Layout (4-6 columns responsive):                       â”‚
â”‚ â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”             â”‚
â”‚ â”‚ Breathwork   â”‚ Meditation   â”‚ Yoga Flow    â”‚             â”‚
â”‚ â”‚ [Hindi]      â”‚ [Hindi]      â”‚ [Hindi]      â”‚             â”‚
â”‚ â”‚ â‚¹499         â”‚ â‚¹499         â”‚ â‚¹599         â”‚             â”‚
â”‚ â”‚ [Buy Now]    â”‚ [Buy Now]    â”‚ [Buy Now]    â”‚             â”‚
â”‚ â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤             â”‚
â”‚ â”‚ Breathwork   â”‚ Meditation   â”‚ Yoga Flow    â”‚             â”‚
â”‚ â”‚ [English]    â”‚ [English]    â”‚ [English]    â”‚             â”‚
â”‚ â”‚ â‚¹599         â”‚ â‚¹599         â”‚ â‚¹699         â”‚             â”‚
â”‚ â”‚ [Buy Now]    â”‚ [Buy Now]    â”‚ [Buy Now]    â”‚             â”‚
â”‚ â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤             â”‚
â”‚ â”‚ Breathwork   â”‚ Meditation   â”‚ Yoga Flow    â”‚             â”‚
â”‚ â”‚ [Marathi]    â”‚ [Marathi]    â”‚ [Marathi]    â”‚             â”‚
â”‚ â”‚ â‚¹499         â”‚ â‚¹499         â”‚ â‚¹599         â”‚             â”‚
â”‚ â”‚ [Buy Now]    â”‚ [Buy Now]    â”‚ [Buy Now]    â”‚             â”‚
â”‚ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜             â”‚
â”‚                                                             â”‚
â”‚ Filter Options:                                             â”‚
â”‚ â˜ Hindi    â˜ English    â˜ Marathi                          â”‚
â”‚                                                             â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

Step 3: User Purchase & Access
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ User clicks "Buy Now" on Breathwork [English]              â”‚
â”‚ â””â”€ PayU Payment âœ“                                           â”‚
â”‚ â””â”€ UserWorkshopProgress created:                           â”‚
â”‚    {                                                         â”‚
â”‚      userId: "user123",                                     â”‚
â”‚      recordedWorkshopId: "breathwork_id",                  â”‚
â”‚      language: "english",                                   â”‚
â”‚      purchasedAt: now,                                      â”‚
â”‚      registeredDevices: [{                                  â”‚
â”‚        deviceId: "fingerprint_xyz",                         â”‚
â”‚        firstAccessAt: now,                                  â”‚
â”‚        isActive: true                                       â”‚
â”‚      }],                                                    â”‚
â”‚      watchProgress: { ... },                               â”‚
â”‚      status: "active"                                       â”‚
â”‚    }                                                         â”‚
â”‚                                                             â”‚
â”‚ â””â”€ Video appears in "My Sessions" page                     â”‚
â”‚ â””â”€ Can watch on app/website with access control            â”‚
â”‚ â””â”€ Can download materials (if enabled)                     â”‚
â”‚ â””â”€ Tracking begins: watch progress, time, etc.             â”‚
â”‚                                                             â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

## ğŸ’¾ Database Schema Relationships

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚     User             â”‚
â”‚  (from User model)   â”‚
â”‚                      â”‚
â”‚ _id                  â”‚
â”‚ email                â”‚
â”‚ password             â”‚
â”‚ userId               â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
           â”‚
           â”‚ 1:Many
           â”‚
           â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚   UserWorkshopProgress           â”‚
â”‚   (New model)                    â”‚
â”‚                                  â”‚
â”‚ userId (ref User)                â”‚
â”‚ recordedWorkshopId (ref RW)      â”‚
â”‚ language                         â”‚
â”‚ purchasedAt                      â”‚
â”‚ registeredDevices[]              â”‚
â”‚ watchProgress                    â”‚
â”‚ certificateStatus                â”‚
â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
       â”‚
       â”‚ references
       â”‚
       â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚    RecordedWorkshop              â”‚
â”‚    (New model)                   â”‚
â”‚                                  â”‚
â”‚ workshopSlug                     â”‚
â”‚ title                            â”‚
â”‚ languages { hindi, english, ... }â”‚
â”‚ pricing                          â”‚
â”‚ materials[]                      â”‚
â”‚ status                           â”‚
â”‚ viewCount, purchaseCount         â”‚
â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
       â”‚
       â”‚ 1:Many
       â”‚
       â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚    Order                         â”‚
â”‚    (Updated)                     â”‚
â”‚                                  â”‚
â”‚ userId (ref User)                â”‚
â”‚ items[] {workshopId, language}   â”‚
â”‚ total                            â”‚
â”‚ paymentStatus                    â”‚
â”‚ payuTxnId                        â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜


â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚    MediaPost                     â”‚
â”‚    (New model)                   â”‚
â”‚                                  â”‚
â”‚ title                            â”‚
â”‚ blocks[] {                       â”‚
â”‚   type,                          â”‚
â”‚   media: { url, type }           â”‚
â”‚ }                                â”‚
â”‚ leftSidebar { items[] }          â”‚
â”‚ rightSidebar { items[] }         â”‚
â”‚ status                           â”‚
â”‚ socialMedia { postToWA, ... }    â”‚
â”‚ views, clicks, shares            â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜


â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚    Lead (existing)               â”‚
â”‚    (Updated for RW)              â”‚
â”‚                                  â”‚
â”‚ phoneNumber                      â”‚
â”‚ name                             â”‚
â”‚ email                            â”‚
â”‚ workshopId (now can ref RW)      â”‚
â”‚ userIdPassword {                 â”‚
â”‚   userId,                        â”‚
â”‚   password,                      â”‚
â”‚   recordedWorkshopId             â”‚
â”‚ }                                â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

**Architecture ready! All infrastructure in place. Next: Frontend UI components** ğŸš€
